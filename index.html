<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Nutricional Mafer</title>
    <style>
        :root {
            --primary: #4CAF50; /* Green */
            --secondary: #FF9800; /* Orange */
            --accent: #2196F3; /* Blue */
            --bg: #F5F7FA;
            --card: #ffffff;
            --text: #333333;
            --done: #e0e0e0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding-bottom: 90px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), #2E7D32);
            color: white;
            padding: 20px 20px 30px 20px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        p { margin: 5px 0; font-size: 0.9rem; opacity: 0.9; }

        /* Language Switcher */
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 5px;
            display: flex;
            gap: 5px;
        }
        .lang-btn {
            background: none;
            border: none;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            opacity: 0.6;
            cursor: pointer;
        }
        .lang-btn.active { opacity: 1; text-decoration: underline; }

        /* Navigation */
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        nav button {
            background: none;
            border: none;
            color: #888;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-weight: bold;
        }

        nav button.active { color: var(--primary); }
        nav button span { font-size: 1.5rem; margin-bottom: 2px; }

        /* Sections */
        .section { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Day Scroller */
        .day-scroller {
            display: flex;
            overflow-x: auto;
            padding-bottom: 10px;
            gap: 10px;
            margin-bottom: 15px;
            scrollbar-width: none;
        }
        .day-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            white-space: nowrap;
            font-weight: bold;
            position: relative;
        }
        .day-btn.active { background: var(--primary); color: white; }
        .day-btn.completed-day::after {
            content: '‚úì';
            font-size: 0.7rem;
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Meal Cards with Checkbox Logic */
        .card {
            background: var(--card);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid var(--primary);
            position: relative;
            transition: background 0.3s;
        }
        
        .card.checked {
            background: #f0f0f0;
            border-left-color: #bbb;
        }
        .card.checked .meal-title, .card.checked .meal-content {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .check-circle {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
        }
        .card.checked .check-circle {
            background: var(--primary);
            border-color: var(--primary);
        }
        .card.checked .check-circle::after {
            content: '‚úì';
            color: white;
            position: absolute;
            top: 0;
            left: 5px;
            font-size: 16px;
        }

        .meal-title { font-weight: bold; color: #555; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
        .meal-content { margin-top: 5px; font-size: 1rem; padding-right: 30px; }
        .note { font-size: 0.8rem; color: #666; font-style: italic; margin-top: 5px; }

        /* Buttons & Inputs */
        input, select, textarea {
            width: 100%; padding: 10px; margin: 5px 0 15px 0;
            border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: inherit;
        }
        button.action-btn {
            background: var(--secondary); color: white; border: none;
            padding: 12px; width: 100%; border-radius: 10px;
            font-size: 1rem; font-weight: bold; cursor: pointer;
        }
        .random-btn {
            background: var(--primary); color: white; border: none; padding: 15px;
            width: 100%; border-radius: 12px; font-size: 1.1rem; font-weight: bold;
            margin-bottom: 20px; box-shadow: 0 4px 0 #388E3C; transition: transform 0.1s;
        }
        .random-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .reset-btn {
            background: none; border: 1px solid red; color: red;
            padding: 10px; width: 100%; border-radius: 8px; margin-top: 20px;
        }

    </style>
</head>
<body>

    <header>
        <div class="lang-switch">
            <button class="lang-btn active" onclick="setLang('es')">ES</button>
            <button class="lang-btn" onclick="setLang('en')">EN</button>
            <button class="lang-btn" onclick="setLang('no')">NO</button>
        </div>
        <h1 id="appTitle">üçé Plan Mafer</h1>
        <p id="appSubtitle">1300 Kcal | Sin Gluten | Low FODMAP</p>
    </header>

    <div id="plan" class="section active">
        <div class="day-scroller" id="dayScroller"></div>
        
        <div id="cycle-info" style="text-align: center; margin-bottom: 10px; font-size: 0.85rem; color: #666;">
            </div>

        <div id="menuContent"></div>
        
        <button class="reset-btn" onclick="resetCycle()" id="resetBtn">Reiniciar Ciclo (Start Over)</button>
    </div>

    <div id="ideas" class="section">
        <h2 id="ideaTitle">üé≤ ¬øQu√© comemos hoy?</h2>
        <p id="ideaSub">Genera una combinaci√≥n v√°lida.</p>
        
        <button class="random-btn" onclick="generateRandomMeal('lunch')" id="btnLunch">Generar Almuerzo</button>
        <button class="random-btn" style="background-color: var(--accent); box-shadow: 0 4px 0 #1976D2;" onclick="generateRandomMeal('dinner')" id="btnDinner">Generar Cena</button>
        
        <div id="randomResult" class="card" style="display:none; border-left-color: var(--secondary);">
            <div class="meal-title" id="resTitle">Sugerencia:</div>
            <div class="meal-content" id="randomText"></div>
            <div class="note" id="resNote">Recuerda: Preparaciones a la plancha, horno o air fryer.</div>
        </div>

        <div class="card">
            <h3 id="remTitle">Recordatorios</h3>
            <ul style="padding-left: 20px; font-size:0.9rem;">
                <li id="rem1"><strong>Vegetales:</strong> 2 tazas cocidos.</li>
                <li id="rem2"><strong>Frutas:</strong> 3 raciones al d√≠a.</li>
                <li id="rem3"><strong>Agua:</strong> 8 vasos.</li>
                <li id="rem4"><strong>Prohibido:</strong> Az√∫car, L√°cteos con lactosa.</li>
            </ul>
        </div>
    </div>

    <div id="tracker" class="section">
        <h2 id="trackTitle">üìä Diario de Salud</h2>
        <div class="card">
            <div class="meal-title" id="newLogTitle">Nuevo Registro</div>
            <label id="lblGluc">Glucosa (mg/dL):</label>
            <input type="number" id="glucose" placeholder="95">
            
            <label id="lblSymp">S√≠ntomas:</label>
            <input type="text" id="symptoms" placeholder="...">
            
            <label id="lblNote">Notas:</label>
            <textarea id="notes" rows="2" placeholder="..."></textarea>
            
            <button class="action-btn" onclick="saveLog()" id="btnSave">Guardar Registro</button>
        </div>

        <h3 id="histTitle">Historial</h3>
        <div id="logHistory"></div>
        <br>
        <button onclick="clearLogs()" style="color: red; background: none; border: none; width: 100%; text-align: center;" id="btnClear">Borrar Historial</button>
    </div>

    <nav>
        <button class="active" onclick="switchTab('plan', this)">
            <span>üìÖ</span> <span class="nav-text" data-key="navPlan">Plan</span>
        </button>
        <button onclick="switchTab('ideas', this)">
            <span>üë©‚Äçüç≥</span> <span class="nav-text" data-key="navIdeas">Ideas</span>
        </button>
        <button onclick="switchTab('tracker', this)">
            <span>üìà</span> <span class="nav-text" data-key="navHealth">Salud</span>
        </button>
    </nav>

    <script>
        // --- TRANSLATIONS CONFIG ---
        let currentLang = 'es';
        
        const uiText = {
            es: {
                subtitle: "1300 Kcal | Sin Gluten | Low FODMAP",
                cycleInfo: "Marca las comidas completadas para seguir tu progreso.",
                reset: "Reiniciar Ciclo",
                ideaTitle: "üé≤ ¬øQu√© comemos hoy?",
                ideaSub: "Genera una combinaci√≥n v√°lida.",
                btnLunch: "Generar Almuerzo",
                btnDinner: "Generar Cena",
                resTitle: "Sugerencia",
                resNote: "Recuerda: Preparaciones a la plancha, horno o air fryer.",
                remTitle: "Recordatorios",
                rem1: "<strong>Vegetales:</strong> 2 tazas cocidos (mejor digesti√≥n).",
                rem2: "<strong>Frutas:</strong> 3 raciones al d√≠a.",
                rem3: "<strong>Agua:</strong> 8 vasos (o infusiones).",
                rem4: "<strong>Prohibido:</strong> Az√∫car, l√°cteos con lactosa.",
                trackTitle: "üìä Diario de Salud",
                newLog: "Nuevo Registro",
                lblGluc: "Glucosa (mg/dL):",
                lblSymp: "S√≠ntomas (Insulina/H√≠gado):",
                lblNote: "Notas:",
                btnSave: "Guardar Registro",
                histTitle: "Historial",
                btnClear: "Borrar Historial",
                navPlan: "Plan",
                navIdeas: "Ideas",
                navHealth: "Salud",
                mealB: "Desayuno",
                mealL: "Almuerzo",
                mealD: "Cena",
                mealS: "Merienda",
                alertSaved: "Registro guardado ‚ú®",
                alertReset: "¬øReiniciar el ciclo de 10 d√≠as? Esto borrar√° tus marcas."
            },
            en: {
                subtitle: "1300 Kcal | Gluten Free | Low FODMAP",
                cycleInfo: "Check off meals to track your 10-day progress.",
                reset: "Reset Cycle",
                ideaTitle: "üé≤ What to eat?",
                ideaSub: "Generate a valid combo.",
                btnLunch: "Generate Lunch",
                btnDinner: "Generate Dinner",
                resTitle: "Suggestion",
                resNote: "Remember: Grilled, baked, or air fryer only.",
                remTitle: "Reminders",
                rem1: "<strong>Veggies:</strong> 2 cups cooked (better digestion).",
                rem2: "<strong>Fruits:</strong> 3 portions per day.",
                rem3: "<strong>Water:</strong> 8 glasses (or tea).",
                rem4: "<strong>Forbidden:</strong> Sugar, lactose dairy.",
                trackTitle: "üìä Health Log",
                newLog: "New Entry",
                lblGluc: "Glucose (mg/dL):",
                lblSymp: "Symptoms (Insulin/Liver):",
                lblNote: "Notes:",
                btnSave: "Save Entry",
                histTitle: "History",
                btnClear: "Clear History",
                navPlan: "Plan",
                navIdeas: "Ideas",
                navHealth: "Health",
                mealB: "Breakfast",
                mealL: "Lunch",
                mealD: "Dinner",
                mealS: "Snack",
                alertSaved: "Entry saved ‚ú®",
                alertReset: "Reset the 10-day cycle? This will clear your checkmarks."
            },
            no: {
                subtitle: "1300 Kcal | Glutenfri | Lav FODMAP",
                cycleInfo: "Merk m√•ltider for √• spore fremgangen din.",
                reset: "Nullstill Syklus",
                ideaTitle: "üé≤ Hva skal vi spise?",
                ideaSub: "Generer en gyldig kombinasjon.",
                btnLunch: "Generer Lunsj",
                btnDinner: "Generer Middag",
                resTitle: "Forslag",
                resNote: "Husk: Grillet, bakt eller air fryer.",
                remTitle: "P√•minnelser",
                rem1: "<strong>Gr√∏nnsaker:</strong> 2 kopper kokt.",
                rem2: "<strong>Frukt:</strong> 3 porsjoner per dag.",
                rem3: "<strong>Vann:</strong> 8 glass (eller te).",
                rem4: "<strong>Forbudt:</strong> Sukker, laktose.",
                trackTitle: "üìä Helselogg",
                newLog: "Ny Oppf√∏ring",
                lblGluc: "Glukose (mg/dL):",
                lblSymp: "Symptomer:",
                lblNote: "Notater:",
                btnSave: "Lagre",
                histTitle: "Historikk",
                btnClear: "Slett Historikk",
                navPlan: "Plan",
                navIdeas: "Ideer",
                navHealth: "Helse",
                mealB: "Frokost",
                mealL: "Lunsj",
                mealD: "Middag",
                mealS: "Mellomm√•ltid",
                alertSaved: "Lagret ‚ú®",
                alertReset: "Nullstill 10-dagers syklusen?"
            }
        };

        // --- MENU DATA (Trilingual) [Source: 1-13, 17-24] ---
        const menuData = {
            1: {
                es: { b: "Queso semi duro (90g) + Arepa Asada (100g) + Aguacate.", l: "Pechuga empanizada (Air Fryer 90g) + Papas (2) + Ensalada.", d: "Hamburguesa de Carne Molida + Casabe + Tomate/Lechuga." },
                en: { b: "Semi-hard cheese (90g) + Grilled Arepa (100g) + Avocado.", l: "Breaded Chicken (Air Fryer 90g) + Potatoes (2) + Salad.", d: "Beef Burger + Cassava Bread + Tomato/Lettuce." },
                no: { b: "Halvfast ost (90g) + Grillet Arepa (100g) + Avokado.", l: "Panert kylling (Air Fryer 90g) + Poteter (2) + Salat.", d: "Hamburger + Kassavabr√∏d + Tomat/Salat." }
            },
            2: {
                es: { b: "Jam√≥n de Pavo (3 reb) + Arepa de batata + Alfalfa.", l: "Calabacines rellenos carne molida (90g) + Arroz Blanco.", d: "Ensalada de At√∫n (90g) + Arepa peque√±a + Cebolla." },
                en: { b: "Turkey Ham (3 slices) + Sweet Potato Arepa + Alfalfa.", l: "Stuffed Zucchini with beef (90g) + White Rice.", d: "Tuna Salad (90g) + Small Arepa + Onion." },
                no: { b: "Kalkunskinke (3 skiver) + S√∏tpotet Arepa + Alfalfa.", l: "Fylt Squash med kj√∏ttdeig (90g) + Hvit ris.", d: "Tunfisksalat (90g) + Liten Arepa + L√∏k." }
            },
            3: {
                es: { b: "Pollo en salsa (90g) + Papas rellenas (2) + Aceite.", l: "At√∫n al ajillo (90g) + Yuca sancochada + Berros.", d: "Carne molida (4 cdas) + Tortilla ma√≠z (Burrito) + Guacamole." },
                en: { b: "Chicken in sauce (90g) + Stuffed Potatoes (2) + Oil.", l: "Garlic Tuna (90g) + Boiled Cassava + Watercress.", d: "Minced Meat + Corn Tortilla (Burrito) + Guacamole." },
                no: { b: "Kylling i saus (90g) + Fylte poteter (2) + Olje.", l: "Hvitl√∏kstunfisk (90g) + Kokt Kassava + Br√∏nnkarse.", d: "Kj√∏ttdeig + Maistortilla (Burrito) + Guacamole." }
            },
            4: {
                es: { b: "Carne Molida magra + Arepa con Ajonjol√≠ + Aguacate.", l: "Arroz con pollo y vegetales + Ensalada.", d: "Jam√≥n y Queso Mozzarella B√∫fala + Tortilla pl√°tano." },
                en: { b: "Lean Minced Meat + Sesame Arepa + Avocado.", l: "Chicken and Vegetable Rice + Salad.", d: "Ham & Buffalo Mozzarella + Plantain Tortilla." },
                no: { b: "Mager kj√∏ttdeig + Sesam Arepa + Avokado.", l: "Ris med kylling og gr√∏nnsaker + Salat.", d: "Skinke og b√∏ffelmozzarella + Banantortilla." }
            },
            5: {
                es: { b: "Ensalada de At√∫n (6 cdas) + Casabe (60g).", l: "Parrilla de Carne con vegetales + Bollitos + Ensalada.", d: "Bu√±uelos de Yuca (Air Fryer)." },
                en: { b: "Tuna Salad (6 tbsp) + Cassava Bread (60g).", l: "Grilled Beef with veggies + Corn Dumplings + Salad.", d: "Cassava Fritters (Air Fryer)." },
                no: { b: "Tunfisksalat (6 ss) + Kassavabr√∏d (60g).", l: "Grillet biff med gr√∏nnsaker + Maisboller + Salat.", d: "Kassavaboller (Air Fryer)." }
            },
            6: {
                es: { b: "Pollo esmechado (90g) + Tortilla pl√°tano + Margarina.", l: "Asado Negro (90g) + Arroz (1 tz) + Ensalada.", d: "Jam√≥n de Pavo + Galletas de Arroz (2 paq) + Ensalada." },
                en: { b: "Shredded Chicken (90g) + Plantain Tortilla + Margarine.", l: "Asado Negro (Beef) + Rice (1 cup) + Salad.", d: "Turkey Ham + Rice Cakes (2 packs) + Salad." },
                no: { b: "Revet kylling (90g) + Banantortilla + Margarin.", l: "Asado Negro (Oksekj√∏tt) + Ris (1 kopp) + Salat.", d: "Kalkunskinke + Riskaker (2 pakker) + Salat." }
            },
            7: {
                es: { b: "Pavo (90g) + Crepes harina de arroz + Vegetales.", l: "Pescado al Horno (90g) + Casabe + Ensalada papa.", d: "Queso Amarillo + 1 reb Jam√≥n + Yuca." },
                en: { b: "Turkey (90g) + Rice Flour Crepes + Veggies.", l: "Baked Fish (90g) + Cassava Bread + Potato Salad.", d: "Yellow Cheese + 1 Ham slice + Cassava." },
                no: { b: "Kalkun (90g) + Rismelpannekaker + Gr√∏nnsaker.", l: "Bakt fisk (90g) + Kassavabr√∏d + Potetsalat.", d: "Gul ost + 1 skinkeskive + Kassava." }
            },
            8: {
                es: { b: "Pollo esmechado (90g) + Arepa asada + Aguacate.", l: "Pollo a la plancha (90g) + Arroz + Br√≥coli/tomate.", d: "Tortilla calabac√≠n / 2 claras huevo + Jam√≥n rallado." },
                en: { b: "Shredded Chicken (90g) + Grilled Arepa + Avocado.", l: "Grilled Chicken (90g) + Rice + Broccoli/Tomato.", d: "Zucchini Omelet / 2 egg whites + Grated Ham." },
                no: { b: "Revet kylling (90g) + Grillet Arepa + Avokado.", l: "Grillet kylling (90g) + Ris + Brokkoli/Tomat.", d: "Squashomelett / 2 eggehviter + Revet skinke." }
            },
            9: {
                es: { b: "Pl√°tano maduro horneado + Queso B√∫fala.", l: "Hamburguesa carne (90g) + Pan sin gluten + Papa brava.", d: "Ensalada Capresa (30g B√∫fala) + Galleta soda." },
                en: { b: "Baked Sweet Plantain + Buffalo Cheese.", l: "Beef Burger (90g) + GF Bun + Spicy Potato.", d: "Caprese Salad (30g Buffalo) + Soda Cracker." },
                no: { b: "Bakt s√∏tbanan + B√∏ffelost.", l: "Hamburger (90g) + Glutenfritt br√∏d + Krydret potet.", d: "Caprese-salat (30g B√∏ffel) + Sodakjeks." }
            },
            10: {
                es: { b: "Queso de cabra (90g) + Arepa mediana + Margarina.", l: "Croquetas de pescado (Air Fryer 90g) + Arroz.", d: "Sopa combinada de auyama/apio + Carne (90g)." },
                en: { b: "Goat Cheese (90g) + Medium Arepa + Margarine.", l: "Fish Croquettes (Air Fryer 90g) + Rice.", d: "Pumpkin/Celery Soup + Beef (90g)." },
                no: { b: "Geitost (90g) + Medium Arepa + Margarin.", l: "Fiskekaker (Air Fryer 90g) + Ris.", d: "Gresskar/Sellerisuppe + Kj√∏tt (90g)." }
            }
        };

        const randomLists = {
            es: { p: ["Pollo", "Carne", "Pescado", "At√∫n", "Queso", "Huevos"], s: ["Arroz", "Yuca", "Batata", "Pl√°tano", "Arepa", "Pasta SG"], v: ["Calabac√≠n", "Vainitas", "Zanahoria", "Espinacas", "Berenjena"], f: ["Aguacate", "Aceite Oliva", "Aceitunas"] },
            en: { p: ["Chicken", "Beef", "Fish", "Tuna", "Cheese", "Eggs"], s: ["Rice", "Cassava", "Swt Potato", "Plantain", "Arepa", "GF Pasta"], v: ["Zucchini", "Green Beans", "Carrot", "Spinach", "Eggplant"], f: ["Avocado", "Olive Oil", "Olives"] },
            no: { p: ["Kylling", "Kj√∏tt", "Fisk", "Tunfisk", "Ost", "Egg"], s: ["Ris", "Kassava", "S√∏tpotet", "Banan", "Arepa", "GF Pasta"], v: ["Squash", "Gr√∏nne b√∏nner", "Gulrot", "Spinat", "Aubergine"], f: ["Avokado", "Olivenolje", "Oliven"] }
        };

        // --- APP STATE ---
        let completedMeals = JSON.parse(localStorage.getItem('maferCycleChecks') || '{}');

        // --- FUNCTIONS ---

        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll(`.lang-btn[onclick="setLang('${lang}')"]`).forEach(b => b.classList.add('active'));
            
            // Update static UI
            const t = uiText[lang];
            document.getElementById('appSubtitle').innerText = t.subtitle;
            document.getElementById('cycle-info').innerText = t.cycleInfo;
            document.getElementById('resetBtn').innerText = t.reset;
            document.getElementById('ideaTitle').innerText = t.ideaTitle;
            document.getElementById('ideaSub').innerText = t.ideaSub;
            document.getElementById('btnLunch').innerText = t.btnLunch;
            document.getElementById('btnDinner').innerText = t.btnDinner;
            document.getElementById('resTitle').innerText = t.resTitle;
            document.getElementById('resNote').innerText = t.resNote;
            document.getElementById('remTitle').innerText = t.remTitle;
            document.getElementById('rem1').innerHTML = t.rem1;
            document.getElementById('rem2').innerHTML = t.rem2;
            document.getElementById('rem3').innerHTML = t.rem3;
            document.getElementById('rem4').innerHTML = t.rem4;
            document.getElementById('trackTitle').innerText = t.trackTitle;
            document.getElementById('newLogTitle').innerText = t.newLog;
            document.getElementById('lblGluc').innerText = t.lblGluc;
            document.getElementById('lblSymp').innerText = t.lblSymp;
            document.getElementById('lblNote').innerText = t.lblNote;
            document.getElementById('btnSave').innerText = t.btnSave;
            document.getElementById('histTitle').innerText = t.histTitle;
            document.getElementById('btnClear').innerText = t.btnClear;
            
            document.querySelectorAll('.nav-text').forEach(el => {
                el.innerText = t[el.dataset.key];
            });

            renderDays(); // Re-render plan
        }

        function renderDays() {
            const scroller = document.getElementById('dayScroller');
            const currentActive = document.querySelector('.day-btn.active')?.innerText.split(' ')[1] || 1;
            
            scroller.innerHTML = '';
            for(let i=1; i<=10; i++) {
                const btn = document.createElement('button');
                const isComplete = checkDayCompletion(i);
                btn.className = `day-btn ${i == currentActive ? 'active' : ''} ${isComplete ? 'completed-day' : ''}`;
                btn.innerText = `D√≠a ${i}`;
                btn.onclick = () => showDay(i, btn);
                scroller.appendChild(btn);
            }
            showDay(currentActive);
        }

        function checkDayCompletion(day) {
            return completedMeals[`d${day}_b`] && completedMeals[`d${day}_l`] && completedMeals[`d${day}_d`];
        }

        function showDay(day, btnElement) {
            if(btnElement) {
                document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
            }
            
            const m = menuData[day][currentLang];
            const t = uiText[currentLang];
            const ids = { b: `d${day}_b`, l: `d${day}_l`, d: `d${day}_d` };

            const html = `
                <div class="card ${completedMeals[ids.b] ? 'checked' : ''}" onclick="toggleCheck('${ids.b}', ${day})">
                    <div class="check-circle"></div>
                    <div class="meal-title">üç≥ ${t.mealB}</div>
                    <div class="meal-content">${m.b}</div>
                </div>
                <div class="card" style="border-left-color: var(--secondary);">
                    <div class="meal-title">üçé ${t.mealS} AM</div>
                    <div class="meal-content">1 Fruta / Fruit / Frukt</div>
                </div>
                <div class="card ${completedMeals[ids.l] ? 'checked' : ''}" onclick="toggleCheck('${ids.l}', ${day})">
                    <div class="check-circle"></div>
                    <div class="meal-title">üç≤ ${t.mealL}</div>
                    <div class="meal-content">${m.l}</div>
                </div>
                <div class="card" style="border-left-color: var(--secondary);">
                    <div class="meal-title">üç™ ${t.mealS} PM</div>
                    <div class="meal-content">Fruta / Fruit</div>
                </div>
                <div class="card ${completedMeals[ids.d] ? 'checked' : ''}" style="border-left-color: var(--accent);" onclick="toggleCheck('${ids.d}', ${day})">
                    <div class="check-circle"></div>
                    <div class="meal-title">üåô ${t.mealD}</div>
                    <div class="meal-content">${m.d}</div>
                </div>
            `;
            document.getElementById('menuContent').innerHTML = html;
        }

        function toggleCheck(id, day) {
            if (completedMeals[id]) {
                delete completedMeals[id];
            } else {
                completedMeals[id] = true;
            }
            localStorage.setItem('maferCycleChecks', JSON.stringify(completedMeals));
            showDay(day); // Re-render to show strikethrough
            renderDays(); // Re-render scroller to update checkmarks
        }

        function resetCycle() {
            if(confirm(uiText[currentLang].alertReset)) {
                completedMeals = {};
                localStorage.removeItem('maferCycleChecks');
                renderDays();
            }
        }

        function generateRandomMeal(type) {
            const l = randomLists[currentLang];
            const p = l.p[Math.floor(Math.random() * l.p.length)];
            const s = l.s[Math.floor(Math.random() * l.s.length)];
            const v = l.v[Math.floor(Math.random() * l.v.length)];
            const f = l.f[Math.floor(Math.random() * l.f.length)];
            
            let text = "";
            if (type === 'lunch') {
                text = `<strong>1:</strong> ${p}<br><strong>2:</strong> ${s}<br><strong>3:</strong> ${v}<br><strong>4:</strong> ${f}`;
            } else {
                text = `<strong>1:</strong> ${p}<br><strong>2:</strong> ${s} (small/liten)<br><strong>3:</strong> ${v}`;
            }
            
            document.getElementById('randomText').innerHTML = text;
            document.getElementById('randomResult').style.display = 'block';
        }

        function saveLog() {
            const gluc = document.getElementById('glucose').value;
            const symp = document.getElementById('symptoms').value;
            const note = document.getElementById('notes').value;
            const date = new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            if(!gluc && !symp && !note) return;

            const entry = { date, gluc, symp, note };
            let logs = JSON.parse(localStorage.getItem('maferHealthLogs') || '[]');
            logs.unshift(entry); 
            localStorage.setItem('maferHealthLogs', JSON.stringify(logs));
            
            renderLogs();
            document.getElementById('glucose').value = '';
            document.getElementById('symptoms').value = '';
            document.getElementById('notes').value = '';
            alert(uiText[currentLang].alertSaved);
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem('maferHealthLogs') || '[]');
            const container = document.getElementById('logHistory');
            container.innerHTML = '';

            logs.forEach(log => {
                const div = document.createElement('div');
                div.className = 'card';
                div.style.borderLeftColor = 'var(--accent)';
                div.innerHTML = `
                    <div class="meal-title">${log.date}</div>
                    ${log.gluc ? `<div>ü©∏ ${log.gluc}</div>` : ''}
                    ${log.symp ? `<div>‚ö†Ô∏è ${log.symp}</div>` : ''}
                    ${log.note ? `<div class="note">üìù ${log.note}</div>` : ''}
                `;
                container.appendChild(div);
            });
        }

        function clearLogs() {
            if(confirm("Delete all history?")) {
                localStorage.removeItem('maferHealthLogs');
                renderLogs();
            }
        }

        function switchTab(tabId, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // Init
        setLang('es');
        renderLogs();

    </script>
</body>
</html>

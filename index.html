<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Maria's Protocol</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.getElementById('root').innerHTML = 
            '<div style="padding:20px; color:red; font-size:20px;">Something broke: ' + message + '</div>';
        };
    </script>
    
    <style>
        body {
            /* This ensures content starts below the notch */
            padding-top: env(safe-area-inset-top); 
            padding-bottom: env(safe-area-inset-bottom);
            -webkit-tap-highlight-color: transparent; /* Removes grey box on tap */
        }
    </style>
</head>
<body class="bg-slate-50 select-none touch-manipulation">
    
    <div id="root" class="h-full">
        <div class="p-10 text-center text-slate-400 font-bold animate-pulse">
            Loading App...
        </div>
    </div>

    <script type="text/babel">
        // --- DATA START ---
        const protocolData = {
            userSettings: {
                dailyRations: {
                    [cite_start]// [cite: 14]
                    proteins: { total: 10, unit: "portions", color: "bg-purple-100 text-purple-800" },
                    starches: { total: 5, unit: "portions", color: "bg-blue-100 text-blue-800" },
                    vegetables: { total: 2, unit: "cups", color: "bg-green-100 text-green-800" },
                    fruits: { total: 3, unit: "portions", color: "bg-yellow-100 text-yellow-800" },
                    fats: { total: 2, unit: "portions", color: "bg-orange-100 text-orange-800" }
                },
                morningRoutine: [
                    [cite_start]// [cite: 41]
                    { id: 'm1', task: "Glutamina (Glutanet/Glutapack)", time: "Before Breakfast", completed: false },
                    { id: 'm2', task: "Probiotic (Coll Vital/Colozin)", time: "20 min before meal", completed: false }
                ]
            },
            days: [
                {
                    dayId: 1,
                    meals: {
                        [cite_start]breakfast: { protein: "Queso semi duro (90g)", carb: "Arepa Asada (100g)", fat: "Aguacate (1 trozo)", drink: "Infusión (Jamaica/Linaza)" }, // [cite: 1]
                        [cite_start]lunch: { protein: "Pechuga empanizada Air Fryer (90g)", carb: "Papas (2 unidades)", veggie: "Ensalada rallada + 1 cdta mayonesa" }, // [cite: 3]
                        [cite_start]dinner: { protein: "Carne molida en Hamburguesa", carb: "Casabe", veggie: "Tomate, Lechuga, Pepino" } // [cite: 5]
                    }
                },
                {
                    dayId: 2,
                    meals: {
                        [cite_start]breakfast: { protein: "Jamon de Pavo (3 reb)", carb: "Arepa de batata (1)", fat: "Alfalfa, tomate + Margarina" }, // [cite: 1]
                        [cite_start]lunch: { protein: "Calabacines rellenos carne (90g)", carb: "Arroz Blanco", veggie: "Vegetales de relleno" }, // [cite: 3]
                        [cite_start]dinner: { protein: "Ensalada de Atun (90g)", carb: "Arepa pequeña", veggie: "Cebolla y tomate" } // [cite: 5]
                    }
                },
                {
                    dayId: 3,
                    meals: {
                        [cite_start]breakfast: { protein: "Pollo en salsa (90g)", carb: "Papa rellenas (2x 100g)", fat: "Aceite (1 cdta)" }, // [cite: 1]
                        [cite_start]lunch: { protein: "Atun al ajillo (90g)", carb: "Yuca sancochada", veggie: "Ensalada berros" }, // [cite: 3]
                        [cite_start]dinner: { protein: "Carne molida (4 cdas) + crema", carb: "Tortilla de maíz (Burrito)", veggie: "Guacamole (2 cdas)" } // [cite: 5]
                    }
                },
                {
                    dayId: 4,
                    meals: {
                        [cite_start]breakfast: { protein: "Carne Molida sin grasa", carb: "Arepa con Ajonjolí", fat: "Aguacate (1 trozo)", drink: "Té" }, // [cite: 1]
                        [cite_start]lunch: { protein: "Arroz con pollo y vegetales", carb: "Arroz (included)", veggie: "Ensalada" }, // [cite: 3]
                        [cite_start]dinner: { protein: "Jamon y queso Mozzarella bufala", carb: "Tortilla de platano", veggie: "Vegetales" } // [cite: 5]
                    }
                },
                {
                    dayId: 5,
                    meals: {
                        [cite_start]breakfast: { protein: "Ensalada de Atún (6 cdas)", carb: "Casabe (60g)", fat: "Aceite en ensalada", drink: "Té" }, // [cite: 1]
                        [cite_start]lunch: { protein: "Parrilla Carne/Cebolla/Pimentón", carb: "Bollitos", veggie: "Ensalada Mixta" }, // [cite: 3]
                        [cite_start]dinner: { protein: "Buñuelos de Yuca (Air Fryer)", carb: "Yuca (included)", veggie: "Vegetales al gusto" } // [cite: 5]
                    }
                }
            ]
        };
        // --- DATA END ---

        const Card = ({ children, title }) => (
            <div className="bg-white rounded-2xl shadow-sm p-5 mb-4 border border-slate-100">
                {title && <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">{title}</h2>}
                {children}
            </div>
        );

        const App = () => {
            const [currentDay, setCurrentDay] = React.useState(1);
            const [rations, setRations] = React.useState(protocolData.userSettings.dailyRations);
            const [morningTasks, setMorningTasks] = React.useState(protocolData.userSettings.morningRoutine);

            let dayData = protocolData.days.find(d => d.dayId === currentDay);
            if (!dayData) dayData = protocolData.days[0];
            const menu = dayData.meals;

            const toggleTask = (id) => {
                setMorningTasks(tasks => tasks.map(t => 
                    t.id === id ? { ...t, completed: !t.completed } : t
                ));
            };

            const decrementRation = (type) => {
                setRations(prev => {
                    const current = prev[type].total;
                    if (current <= 0) return prev;
                    return { ...prev, [type]: { ...prev[type], total: current - 1 } };
                });
            };

            return (
                // Added pb-20 for bottom scrolling space
                <div className="min-h-screen p-4 pb-20 font-sans text-slate-800 max-w-md mx-auto">
                    
                    {/* Header */}
                    <header className="flex justify-between items-center mb-6 mt-2">
                        <div>
                            <h1 className="text-2xl font-bold text-slate-900 tracking-tight">Maria's Protocol</h1>
                            <p className="text-slate-500 text-sm font-medium">Day {currentDay} of 10</p>
                        </div>
                        <div className="bg-white shadow-sm border border-slate-100 px-2 py-1 rounded-lg flex space-x-1">
                             <button onClick={() => setCurrentDay(d => d > 1 ? d - 1 : 5)} className="p-2 hover:bg-slate-50 rounded-md text-slate-400 font-bold">←</button>
                             <button onClick={() => setCurrentDay(d => d < 5 ? d + 1 : 1)} className="p-2 hover:bg-slate-50 rounded-md text-purple-600 font-bold">→</button>
                        </div>
                    </header>

                    {/* Morning Routine */}
                    <Card title="Morning Protocol">
                        <div className="space-y-3">
                            {morningTasks.map(task => (
                                <div 
                                    key={task.id} 
                                    onClick={() => toggleTask(task.id)}
                                    className="flex items-center cursor-pointer p-2 -mx-2 hover:bg-slate-50 rounded-lg transition active:scale-[0.98]"
                                >
                                    <div className={`w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center transition-colors ${task.completed ? 'bg-green-500 border-green-500' : 'border-slate-300'}`}>
                                        {task.completed && <span className="text-white text-xs font-bold">✓</span>}
                                    </div>
                                    <div>
                                        <p className={`font-medium text-sm ${task.completed ? 'text-slate-400 line-through' : 'text-slate-700'}`}>
                                            {task.task}
                                        </p>
                                        <p className="text-xs text-slate-400">{task.time}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </Card>

                    {/* Ration Bank */}
                    <Card title="Daily Rations">
                        <div className="grid grid-cols-2 gap-3">
                            {Object.entries(rations).map(([key, data]) => (
                                <button 
                                    key={key}
                                    onClick={() => decrementRation(key)}
                                    className={`${data.color} p-3 rounded-xl flex flex-col items-center justify-center transition active:scale-95 border border-white shadow-sm`}
                                >
                                    <span className="text-2xl font-bold">{data.total}</span>
                                    <span className="text-[10px] uppercase font-bold tracking-wide opacity-70">{key}</span>
                                </button>
                            ))}
                        </div>
                        <p className="text-center text-xs text-slate-300 mt-3 font-medium">Tap to consume</p>
                    </Card>

                    {/* Menu Display */}
                    <div className="space-y-4">
                        <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider ml-1">Today's Menu</h2>

                        {/* Breakfast */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                            <div className="flex items-center mb-3">
                                <span className="w-2 h-2 rounded-full bg-orange-500 mr-2"></span>
                                <h3 className="text-sm font-bold text-slate-700 uppercase">Breakfast</h3>
                            </div>
                            <div className="space-y-1">
                                <p className="font-semibold text-slate-800 text-lg leading-tight">{menu?.breakfast?.protein}</p>
                                <p className="text-sm text-slate-500">+ {menu?.breakfast?.carb}</p>
                                <p className="text-sm text-slate-500">+ {menu?.breakfast?.fat}</p>
                            </div>
                            {menu?.breakfast?.drink && (
                                <div className="mt-3 pt-3 border-t border-slate-50 flex items-center text-xs text-slate-400 font-medium">
                                    <span className="mr-1 text-base">☕</span> {menu.breakfast.drink}
                                </div>
                            )}
                        </div>

                        {/* Lunch */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                            <div className="flex items-center mb-3">
                                <span className="w-2 h-2 rounded-full bg-green-500 mr-2"></span>
                                <h3 className="text-sm font-bold text-slate-700 uppercase">Lunch</h3>
                            </div>
                            <div className="space-y-1">
                                <p className="font-semibold text-slate-800 text-lg leading-tight">{menu?.lunch?.protein}</p>
                                <p className="text-sm text-slate-500">+ {menu?.lunch?.carb}</p>
                                <p className="text-sm text-slate-500">+ {menu?.lunch?.veggie}</p>
                            </div>
                        </div>

                        {/* Dinner */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                             <div className="flex items-center mb-3">
                                <span className="w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
                                <h3 className="text-sm font-bold text-slate-700 uppercase">Dinner</h3>
                            </div>
                            <div className="space-y-1">
                                <p className="font-semibold text-slate-800 text-lg leading-tight">{menu?.dinner?.protein}</p>
                                <p className="text-sm text-slate-500">+ {menu?.dinner?.carb}</p>
                                <p className="text-sm text-slate-500">+ {menu?.dinner?.veggie}</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

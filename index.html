<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maria's Protocol</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.getElementById('root').innerHTML = 
            '<div style="padding:20px; color:red; font-size:20px;">Something broke: ' + message + '</div>';
        };
    </script>
</head>
<body class="bg-slate-50">
    
    <div id="root" class="p-10 text-center text-slate-500 font-bold">
        Loading Maria's Protocol...
    </div>

    <script type="text/babel">
        // --- DATA START ---
        const protocolData = {
            userSettings: {
                dailyRations: {
                    proteins: { total: 10, unit: "portions", color: "bg-purple-100 text-purple-800" },
                    starches: { total: 5, unit: "portions", color: "bg-blue-100 text-blue-800" },
                    vegetables: { total: 2, unit: "cups", color: "bg-green-100 text-green-800" },
                    fruits: { total: 3, unit: "portions", color: "bg-yellow-100 text-yellow-800" },
                    fats: { total: 2, unit: "portions", color: "bg-orange-100 text-orange-800" }
                },
                morningRoutine: [
                    { id: 'm1', task: "Glutamina (Glutanet/Glutapack)", time: "Before Breakfast", completed: false },
                    { id: 'm2', task: "Probiotic (Coll Vital/Colozin)", time: "20 min before meal", completed: false }
                ]
            },
            days: [
                {
                    dayId: 1,
                    meals: {
                        breakfast: { protein: "Queso semi duro (90g)", carb: "Arepa Asada (100g)", fat: "Aguacate (1 trozo)", drink: "Infusión (Jamaica/Linaza)" },
                        lunch: { protein: "Pechuga empanizada Air Fryer (90g)", carb: "Papas (2 unidades)", veggie: "Ensalada rallada + 1 cdta mayonesa" },
                        dinner: { protein: "Carne molida en Hamburguesa", carb: "Casabe", veggie: "Tomate, Lechuga, Pepino" }
                    }
                },
                {
                    dayId: 2,
                    meals: {
                        breakfast: { protein: "Jamon de Pavo (3 reb)", carb: "Arepa de batata (1)", fat: "Alfalfa, tomate + Margarina" },
                        lunch: { protein: "Calabacines rellenos carne (90g)", carb: "Arroz Blanco", veggie: "Vegetales de relleno" },
                        dinner: { protein: "Ensalada de Atun (90g)", carb: "Arepa pequeña", veggie: "Cebolla y tomate" }
                    }
                },
                {
                    dayId: 3,
                    meals: {
                        breakfast: { protein: "Pollo en salsa (90g)", carb: "Papa rellenas (2x 100g)", fat: "Aceite (1 cdta)" },
                        lunch: { protein: "Atun al ajillo (90g)", carb: "Yuca sancochada", veggie: "Ensalada berros" },
                        dinner: { protein: "Carne molida (4 cdas) + crema", carb: "Tortilla de maíz (Burrito)", veggie: "Guacamole (2 cdas)" }
                    }
                },
                {
                    dayId: 4,
                    meals: {
                        breakfast: { protein: "Carne Molida sin grasa", carb: "Arepa con Ajonjolí", fat: "Aguacate (1 trozo)", drink: "Té" },
                        lunch: { protein: "Arroz con pollo y vegetales", carb: "Arroz (included)", veggie: "Ensalada" },
                        dinner: { protein: "Jamon y queso Mozzarella bufala", carb: "Tortilla de platano", veggie: "Vegetales" }
                    }
                },
                {
                    dayId: 5,
                    meals: {
                        breakfast: { protein: "Ensalada de Atún (6 cdas)", carb: "Casabe (60g)", fat: "Aceite en ensalada", drink: "Té" },
                        lunch: { protein: "Parrilla Carne/Cebolla/Pimentón", carb: "Bollitos", veggie: "Ensalada Mixta" },
                        dinner: { protein: "Buñuelos de Yuca (Air Fryer)", carb: "Yuca (included)", veggie: "Vegetales al gusto" }
                    }
                }
            ]
        };
        // --- DATA END ---

        // --- COMPONENTS ---
        const Card = ({ children, title }) => (
            <div className="bg-white rounded-2xl shadow-sm p-5 mb-4">
                {title && <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">{title}</h2>}
                {children}
            </div>
        );

        const App = () => {
            const [currentDay, setCurrentDay] = React.useState(1);
            const [rations, setRations] = React.useState(protocolData.userSettings.dailyRations);
            const [morningTasks, setMorningTasks] = React.useState(protocolData.userSettings.morningRoutine);

            // Safer data fetching
            let dayData = protocolData.days.find(d => d.dayId === currentDay);
            if (!dayData) dayData = protocolData.days[0];
            const menu = dayData.meals;

            const toggleTask = (id) => {
                setMorningTasks(tasks => tasks.map(t => 
                    t.id === id ? { ...t, completed: !t.completed } : t
                ));
            };

            const decrementRation = (type) => {
                setRations(prev => {
                    const current = prev[type].total;
                    if (current <= 0) return prev;
                    return { ...prev, [type]: { ...prev[type], total: current - 1 } };
                });
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 font-sans text-slate-800 max-w-md mx-auto">
                    
                    {/* Header */}
                    <header className="flex justify-between items-center mb-6 mt-2">
                        <div>
                            <h1 className="text-2xl font-bold text-slate-900">Maria's Protocol</h1>
                            <p className="text-slate-500 text-sm">Healing & Nutrition</p>
                        </div>
                        <div className="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-bold">
                            Day {currentDay}
                        </div>
                    </header>

                    {/* Morning Routine */}
                    <Card title="Morning Protocol">
                        <div className="space-y-3">
                            {morningTasks.map(task => (
                                <div 
                                    key={task.id} 
                                    onClick={() => toggleTask(task.id)}
                                    className="flex items-center cursor-pointer p-2 hover:bg-slate-50 rounded-lg transition"
                                >
                                    <div className={`w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center ${task.completed ? 'bg-green-500 border-green-500' : 'border-slate-300'}`}>
                                        {task.completed && <span className="text-white text-xs">✓</span>}
                                    </div>
                                    <div>
                                        <p className={`font-medium ${task.completed ? 'text-slate-400 line-through' : 'text-slate-700'}`}>
                                            {task.task}
                                        </p>
                                        <p className="text-xs text-slate-400">{task.time}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </Card>

                    {/* Ration Bank */}
                    <Card title="Daily Rations Left">
                        <div className="grid grid-cols-2 gap-3">
                            {Object.entries(rations).map(([key, data]) => (
                                <button 
                                    key={key}
                                    onClick={() => decrementRation(key)}
                                    className={`${data.color} p-3 rounded-xl flex flex-col items-center justify-center transition active:scale-95`}
                                >
                                    <span className="text-2xl font-bold">{data.total}</span>
                                    <span className="text-xs uppercase font-medium">{key}</span>
                                </button>
                            ))}
                        </div>
                        <p className="text-center text-xs text-slate-400 mt-3">Tap to use a ration</p>
                    </Card>

                    {/* Menu Display */}
                    <Card>
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-lg font-bold text-slate-800">Today's Menu</h2>
                            <div className="flex space-x-2">
                                <button onClick={() => setCurrentDay(d => d > 1 ? d - 1 : 5)} className="px-3 py-1 bg-slate-100 rounded font-bold hover:bg-slate-200">←</button>
                                <button onClick={() => setCurrentDay(d => d < 5 ? d + 1 : 1)} className="px-3 py-1 bg-slate-100 rounded font-bold hover:bg-slate-200">→</button>
                            </div>
                        </div>

                        {/* Breakfast */}
                        <div className="mb-6">
                            <h3 className="text-sm font-bold text-orange-500 uppercase mb-2">Breakfast</h3>
                            <div className="bg-orange-50 p-3 rounded-lg border border-orange-100">
                                <p className="font-medium text-slate-800">{menu && menu.breakfast ? menu.breakfast.protein : 'Loading...'}</p>
                                <p className="text-sm text-slate-600">+ {menu && menu.breakfast ? menu.breakfast.carb : ''}</p>
                                <p className="text-sm text-slate-600">+ {menu && menu.breakfast ? menu.breakfast.fat : ''}</p>
                                {menu && menu.breakfast && menu.breakfast.drink && <p className="text-xs text-orange-700 mt-2 border-t border-orange-200 pt-2">☕ {menu.breakfast.drink}</p>}
                            </div>
                        </div>

                        {/* Lunch */}
                        <div className="mb-6">
                            <h3 className="text-sm font-bold text-green-600 uppercase mb-2">Lunch</h3>
                            <div className="bg-green-50 p-3 rounded-lg border border-green-100">
                                <p className="font-medium text-slate-800">{menu && menu.lunch ? menu.lunch.protein : 'Loading...'}</p>
                                <p className="text-sm text-slate-600">+ {menu && menu.lunch ? menu.lunch.carb : ''}</p>
                                <p className="text-sm text-slate-600">+ {menu && menu.lunch ? menu.lunch.veggie : ''}</p>
                            </div>
                        </div>

                        {/* Dinner */}
                        <div>
                            <h3 className="text-sm font-bold text-blue-600 uppercase mb-2">Dinner</h3>
                            <div className="bg-blue-50 p-3 rounded-lg border border-blue-100">
                                <p className="font-medium text-slate-800">{menu && menu.dinner ? menu.dinner.protein : 'Loading...'}</p>
                                <p className="text-sm text-slate-600">+ {menu && menu.dinner ? menu.dinner.carb : ''}</p>
                                <p className="text-sm text-slate-600">+ {menu && menu.dinner ? menu.dinner.veggie : ''}</p>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
